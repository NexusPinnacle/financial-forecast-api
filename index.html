<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Forecast App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Integrated Financial Forecast</h1>
        <p>Enter your baseline figures and assumptions below.</p>

        <h2>Forecast Settings</h2>
        
        <div class="settings-row">
            <div class="duration-group">
                <label>Total Horizon:</label>
                <div id="annual-buttons" class="duration-buttons">
                    <button type="button" class="year-select-btn selected-year-btn" data-value="5">5 Years</button>
                    <button type="button" class="year-select-btn" data-value="10">10 Years</button>
                </div>
            </div>

            <div class="mode-group">
                <label>Monthly Detail (First):</label>
                <select id="monthly_detail_select" class="styled-select">
                    <option value="0">None (Annual Only)</option>
                    <option value="12">12 Months</option>
                    <option value="24">24 Months</option>
                    <option value="36">36 Months</option>
                </select>
            </div>

            <div class="currency-group">
                <label for="currency_symbol">Currency:</label>
                <select id="currency_symbol" class="styled-select">
                    <option value="$">$ (USD)</option>
                    <option value="£">£ (GBP)</option>
                    <option value="€">€ (EUR)</option>
                    <option value="¥">¥ (JPY)</option>
                </select>
            </div>
        </div>

        <form id="forecastForm">
            <div class="section-container revenue-section">
                <h2>1. Revenue Builder</h2>
                <div id="revenue-streams-container">
                    </div>
                
                <div class="add-stream-ui">
                    <div class="input-group-inline">
                        <label>Stream Name:</label>
                        <input type="text" id="new_stream_name" placeholder="e.g. SaaS Subscriptions">
                    </div>
                    <div class="input-group-inline">
                        <label>Units/Mo (Start):</label>
                        <input type="number" id="new_stream_units" value="100">
                    </div>
                    <div class="input-group-inline">
                        <label>Price per Unit:</label>
                        <input type="number" id="new_stream_price" value="50">
                    </div>
                    <button type="button" id="addStreamBtn" class="secondary-btn">+ Add Revenue Stream</button>
                </div>

                <div class="totals-preview" id="revenue-total-preview">
                    </div>
            </div>

            <div class="section-container cogs-section">
                <h2>2. COGS Builder (Direct Costs)</h2>
                <div id="cogs-streams-container">
                    </div>

                <div class="add-stream-ui">
                    <div class="input-group-inline">
                        <label>Expense Name:</label>
                        <input type="text" id="new_cogs_name" placeholder="e.g. Server Hosting">
                    </div>
                    <div class="input-group-inline">
                        <label>Monthly Cost ($):</label>
                        <input type="number" id="new_cogs_val" value="500">
                    </div>
                    <button type="button" id="addExtraCogsBtn" class="secondary-btn cogs-btn">+ Add Extra COGS</button>
                </div>

                <div class="totals-preview" id="cogs-total-preview">
                    </div>
            </div>

            <div class="section-container opex-section">
                <h2>3. OpEx Builder (Operating Expenses)</h2>
                <div id="opex-streams-container">
                    </div>

                <div class="add-stream-ui opex-add-ui">
                    <div class="input-group-inline">
                        <label>Expense Name:</label>
                        <input type="text" id="new_opex_name" placeholder="e.g. Marketing or Rent">
                    </div>
                    <div class="input-group-inline">
                        <label>Monthly Cost ($):</label>
                        <input type="number" id="new_opex_val" value="1000">
                    </div>
                    <button type="button" id="addOpExBtn" class="secondary-btn opex-btn">+ Add OpEx Stream</button>
                </div>

                <div class="totals-preview" id="opex-total-preview">
                    </div>
            </div>

            <div class="section-container">
                <h2>4. Other Financial Assumptions</h2>
                
                <div class="form-grid">
                    <div class="card">
                        <h3>Growth & Margin Defaults</h3>
                        <p class="instruction">Note: Streams above override these if present.</p>
                        <div class="input-group">
                            <label>Base Initial Annual Revenue ($):</label>
                            <input type="number" name="initial_revenue" step="1000" value="0">
                        </div>
                        <div class="input-group">
                            <label>Annual Revenue Growth (%):</label>
                            <div id="revenue-growth-container" class="granular-inputs"></div>
                        </div>
                        <div class="input-group">
                            <label>COGS (% of Revenue):</label>
                            <div id="cogs-pct-container" class="granular-inputs"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Operating & Tax</h3>
                        <div class="input-group">
                            <label>Base Annual OpEx ($):</label>
                            <div id="fixed-opex-container" class="granular-inputs"></div>
                        </div>
                        <div class="input-group">
                            <label>Corporate Tax Rate (%):</label>
                            <input type="number" name="tax_rate" step="0.01" value="0.21">
                        </div>
                    </div>

                    <div class="card">
                        <h3>Assets & Capex</h3>
                        <div class="input-group">
                            <label>Initial PP&E ($):</label>
                            <input type="number" name="initial_ppe" step="1000" value="50000">
                        </div>
                        <div class="input-group">
                            <label>Annual CapEx ($):</label>
                            <div id="capex-container" class="granular-inputs"></div>
                        </div>
                        <div class="input-group">
                            <label>Annual Depreciation (%):</label>
                            <input type="number" name="depreciation_rate" step="0.01" value="0.10">
                        </div>
                    </div>

                    <div class="card">
                        <h3>Working Capital (Days)</h3>
                        <div class="input-group">
                            <label>DSO (Receivables):</label>
                            <div id="dso-days-container" class="granular-inputs"></div>
                        </div>
                        <div class="input-group">
                            <label>DIO (Inventory):</label>
                            <div id="dio-days-container" class="granular-inputs"></div>
                        </div>
                        <div class="input-group">
                            <label>DPO (Payables):</label>
                            <div id="dpo-days-container" class="granular-inputs"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Debt & Cash</h3>
                        <div class="input-group">
                            <label>Initial Cash Balance ($):</label>
                            <input type="number" name="initial_cash" step="1000" value="100000">
                        </div>
                        <div class="input-group">
                            <label>Initial Debt ($):</label>
                            <input type="number" name="initial_debt" step="1000" value="0">
                        </div>
                        <div class="input-group">
                            <label>Annual Interest Rate (%):</label>
                            <input type="number" name="interest_rate" step="0.01" value="0.05">
                        </div>
                        <div class="input-group">
                            <label>Annual Debt Repayment ($):</label>
                            <div id="debt-repayment-container" class="granular-inputs"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sticky-actions">
                <button type="submit" class="primary-btn">Generate Financial Model</button>
            </div>
        </form>

        <div id="error-message" class="error" style="display:none;"></div>

        <div id="results-container" style="display:none;">
            <div class="tabs">
                <button class="tab-btn active" onclick="openTab(event, 'tab-is')">Income Statement</button>
                <button class="tab-btn" onclick="openTab(event, 'tab-balance')">Balance Sheet</button>
                <button class="tab-btn" onclick="openTab(event, 'tab-cashflow')">Cash Flow</button>
                <button class="tab-btn" onclick="openTab(event, 'tab-charts')">KPI Charts</button>
            </div>

            <div id="tab-is" class="tab-content active">
                <h2>Forecasted Income Statement</h2>
                <div class="table-responsive">
                    <table id="incomeStatementTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-balance" class="tab-content">
                <h2>Forecasted Balance Sheet</h2>
                <div class="table-responsive">
                    <table id="balanceSheetTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-cashflow" class="tab-content">
                <h2>Forecasted Cash Flow Statement</h2>
                <div class="table-responsive">
                    <table id="cashFlowTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-charts" class="tab-content">
                <h2>Forecasted KPIs - Visual Trends</h2>
                <div style="width: 100%; margin: 20px auto; display: flex; flex-wrap: wrap; justify-content: space-around;">
                    <div style="width: 48%; min-width: 350px; margin-bottom: 20px;"><canvas id="revenueKpiChart"></canvas></div>
                    <div style="width: 48%; min-width: 350px; margin-bottom: 20px;"><canvas id="cashDebtChart"></canvas></div>
                </div>
            </div>

            <button id="exportBtn">Export to Excel</button>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="script.js"></script>
</body>
</html>
