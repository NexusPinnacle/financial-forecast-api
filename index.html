<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Forecast App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Integrated Financial Forecast</h1>
        <p>Enter your baseline figures and assumptions below.</p>

        <h2>Forecast Settings</h2>
        
        <div class="settings-row">
            <div class="duration-group">
                <label>Total Horizon:</label>
                <div id="annual-buttons" class="duration-buttons">
                    <button type="button" class="year-select-btn selected-year-btn" data-value="5">5 Years</button>
                    <button type="button" class="year-select-btn" data-value="10">10 Years</button>
                </div>
            </div>

            <div class="mode-group">
                <label>Monthly Detail (First):</label>
                <select id="monthly_detail_select" class="styled-select">
                    <option value="0">None (Annual Only)</option>
                    <option value="12">12 Months</option>
                    <option value="24">24 Months</option>
                    <option value="36">36 Months</option>
                </select>
            </div>

            <div class="currency-group">
                <label for="currency_symbol">Currency:</label>
                <select id="currency_symbol" class="styled-select">
                    <option value="$" selected>USD ($)</option>
                    <option value="€">EUR (€)</option>
                    <option value="£">GBP (£)</option>
                    <option value="¥">JPY (¥)</option>
                </select>
            </div>
        </div>
        
        <form id="forecastForm">
            <input type="hidden" id="forecast_years" value="5"> 
            <input type="hidden" id="monthly_detail" value="0">

            <h2>Revenue Streams (Granular Buildup)</h2>
            <div class="revenue-builder-container">
                <p>Define streams here to auto-calculate the Top Line.</p>
                <div class="stream-form-row">
                    <div class="stream-input-group"><label>Name</label><input type="text" id="new_stream_name" placeholder="Consulting"></div>
                    <div class="stream-input-group">
                        <label>Type</label>
                        <select id="new_stream_type">
                            <option value="unit">Unit Sales</option>
                            <option value="recurring">Recurring</option>
                            <option value="service">Billable Hours</option>
                        </select>
                    </div>
                    <div class="stream-input-group"><label>Price/Rate</label><input type="number" id="new_stream_price" placeholder="0.00"></div>
                    <div class="stream-input-group"><label>Quantity</label><input type="number" id="new_stream_qty" placeholder="0"></div>
                    <div class="stream-input-group"><label>Ann. Growth %</label><input type="number" id="new_stream_growth" value="5"></div>
                    <button type="button" id="addStreamBtn" class="add-btn">+ Add Stream</button>
                </div>
                <div id="revenue-streams-list" class="revenue-streams-list"></div>
                <div id="revenue-previews-container" class="preview-box blue-preview">
                    <h4>Annual Revenue Previews:</h4>
                    <div id="annual-revenue-list" class="preview-grid"></div>
                </div>
            </div>

            <div class="cogs-builder-container">
                <h2>COGS Builder (Direct Costs)</h2>
                <p>Define cost margins for streams or add independent direct costs.</p>
                <div id="stream-cogs-list"></div>
                <div class="add-stream-ui cogs-add-ui">
                    <input type="text" id="new_cogs_name" placeholder="Extra COGS (e.g. Hosting)">
                    <input type="number" id="new_cogs_pct" placeholder="Default %" step="0.1">
                    <button type="button" id="addExtraCogsBtn" class="add-btn red-btn">Add Extra COGS</button>
                </div>
                <div id="cogs-previews-container" class="preview-box red-preview">
                    <h4>Annual COGS Totals:</h4>
                    <div id="annual-cogs-list" class="preview-grid"></div>
                </div>
            </div>

            <div class="opex-builder-container">
                <h2>OpEx Builder (Operating Expenses)</h2>
                <p>Add granular operating expenses like Rent, Marketing, or Salaries.</p>
                <div id="opex-streams-list"></div>
                <div class="add-stream-ui opex-add-ui">
                    <input type="text" id="new_opex_name" placeholder="Expense Name (e.g. Rent)">
                    <input type="number" id="new_opex_base" placeholder="Monthly Amount" step="0.01">
                    <button type="button" id="addOpexStreamBtn" class="add-btn orange-btn">Add OpEx Stream</button>
                </div>
                <div id="opex-previews-container" class="preview-box orange-preview">
                    <h4>Annual OpEx Totals:</h4>
                    <div id="annual-opex-list" class="preview-grid"></div>
                </div>
            </div>
            
            <h2>Baseline & Assumptions</h2>
            <div class="input-layout">
                <div class="left-pane">
                    <h3>Core Assumptions</h3>
                    <div class="input-group">
                        <label for="default_cogs_pct">Default COGS %:</label>
                        <input type="number" id="default_cogs_pct" value="40" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="default_fixed_opex">Default Annual OpEx:</label>
                        <input type="number" id="default_fixed_opex" value="100">
                    </div>
                    <div class="input-group">
                        <label for="tax_rate">Tax Rate (%):</label>
                        <input type="number" id="tax_rate" value="25" step="0.1">
                    </div>
                </div>
                <div class="right-pane">
                    <h3>Capital & Cash</h3>
                    <div class="input-group">
                        <label for="initial_cash">Starting Cash:</label>
                        <input type="number" id="initial_cash" value="200">
                    </div>
                    <div class="input-group">
                        <label for="initial_debt">Starting Debt:</label>
                        <input type="number" id="initial_debt" value="0">
                    </div>
                    <div class="input-group">
                        <label for="interest_rate">Interest Rate (%):</label>
                        <input type="number" id="interest_rate" value="5" step="0.1">
                    </div>
                </div>
            </div>

            <button type="submit" id="calculateBtn">Generate Financial Forecast</button>
        </form>

        <div id="error-message" style="color:red; margin-top:20px;"></div>

        <div id="results-container" style="display:none; margin-top:40px;">
            <div class="tabs-header">
                <button class="tab-link active" onclick="openTab(event, 'tab-income')">Income Statement</button>
                <button class="tab-link" onclick="openTab(event, 'tab-balance')">Balance Sheet</button>
                <button class="tab-link" onclick="openTab(event, 'tab-cashflow')">Cash Flow</button>
                <button class="tab-link" onclick="openTab(event, 'tab-charts')">Visuals</button>
            </div>

            <div id="tab-income" class="tab-content" style="display:block;">
                <h2>Forecasted Income Statement</h2>
                <div class="table-responsive">
                    <table id="incomeStatementTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-balance" class="tab-content">
                <h2>Forecasted Balance Sheet</h2>
                <div class="table-responsive">
                    <table id="balanceSheetTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-cashflow" class="tab-content">
                <h2>Forecasted Cash Flow Statement</h2>
                <div class="table-responsive">
                    <table id="cashFlowTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-charts" class="tab-content">
                <h2>Forecasted KPIs - Visual Trends</h2>
                <div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
                    <div style="width: 48%; min-width: 350px;"><canvas id="revenueKpiChart"></canvas></div>
                    <div style="width: 48%; min-width: 350px;"><canvas id="cashDebtChart"></canvas></div>
                </div>
            </div>

            <button id="exportBtn">Export to Excel</button>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="script.js"></script>
</body>
</html>
