<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Financial Forecast</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="top-nav">
        <button class="nav-btn active" data-section="inputs-page">Assumptions</button>
        <button class="nav-btn" data-section="pl-page" id="nav-pl" disabled>P&L</button>
        <button class="nav-btn" data-section="bs-page" id="nav-bs" disabled>Balance Sheet</button>
        <button class="nav-btn" data-section="cf-page" id="nav-cf" disabled>Cash Flow</button>
    </nav>

    <div class="container">
        <h1>Integrated Financial Forecast</h1>
        
        <div id="inputs-page" class="page-section">
            <p>Enter your baseline figures and assumptions below to generate the multi-year forecast.</p>
            
            <form id="forecastForm">
                <h2>Forecast Settings</h2>
                <div class="input-group" style="justify-content: flex-start; gap: 20px; margin-bottom: 25px; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <div>
                        <label style="display:block; margin-bottom: 5px; font-weight:bold;">Duration:</label>
                        <input type="hidden" id="forecast_years" value="3"> 
                        <div style="display:flex; gap:5px;">
                            <button type="button" class="year-select-btn selected-year-btn" data-years="3">3 Years</button>
                            <button type="button" class="year-select-btn" data-years="5">5 Years</button>
                            <button type="button" class="year-select-btn" data-years="10">10 Years</button>
                        </div>
                    </div>

                    <div style="margin-left: 30px;">
                        <label for="breakdown_months" style="display:block; margin-bottom: 5px; font-weight:bold;">Monthly View:</label>
                        <select id="breakdown_months" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="0">Annual Only</option>
                            <option value="12">First 12 Months</option>
                            <option value="24">First 24 Months</option>
                            <option value="36">First 36 Months</option>
                        </select>
                    </div>
                </div>

                <h2>Baseline & Assumptions</h2>
                <div class="input-layout">
                    <div class="left-pane">
                        <h3>Core Assumptions</h3>
                        <div class="input-group">
                            <label for="currency_symbol">Select Currency:</label>
                            <select id="currency_symbol" style="flex-basis: 35%;">
                                <option value="$" selected>USD ($)</option>
                                <option value="€">EUR (€)</option>
                                <option value="£">GBP (£)</option>
                                <option value="¥">JPY (¥)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="initial_revenue">Initial Revenue (Year 0):</label>
                            <input type="number" id="initial_revenue" value="1000" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="default_revenue_growth">Revenue Growth (Default %):</label>
                            <input type="number" id="default_revenue_growth" value="5" step="0.1" required>
                        </div>
                        <div class="input-group">
                            <label for="default_cogs_pct">COGS as % of Revenue (Default):</label>
                            <input type="number" id="default_cogs_pct" value="40" step="0.1" required>
                        </div>
                        <div class="input-group">
                            <label for="initial_ppe">Initial PP&E (Year 0):</label>
                            <input type="number" id="initial_ppe" value="500" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="default_fixed_opex">Fixed Operating Expenses (Default):</label>
                            <input type="number" id="default_fixed_opex" value="100" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="default_capex">Annual Capital Expenditure (Default):</label>
                            <input type="number" id="default_capex" value="50" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="depreciation_rate">Depreciation Rate (%):</label>
                            <input type="number" id="depreciation_rate" value="10" step="0.1" required>
                        </div>
                        <div class="input-group">
                            <label for="tax_rate">Tax Rate (%):</label>
                            <input type="number" id="tax_rate" value="25" step="0.1" required>
                        </div>

                        <h3>Working Capital Assumptions</h3>
                        <div class="input-group">
                            <label for="default_dso_days">DSO (AR Days):</label>
                            <input type="number" id="default_dso_days" value="45" step="1" required>
                        </div>
                        <div class="input-group">
                            <label for="default_dio_days">DIO (Inventory Days):</label>
                            <input type="number" id="default_dio_days" value="30" step="1" required>
                        </div>
                        <div class="input-group">
                            <label for="default_dpo_days">DPO (AP Days):</label>
                            <input type="number" id="default_dpo_days" value="60" step="1" required>
                        </div>
                        
                        <h3>Financing & Cash</h3>
                        <div class="input-group">
                            <label for="initial_cash">Initial Cash (Year 0):</label>
                            <input type="number" id="initial_cash" value="100" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="initial_debt">Initial Debt (Year 0):</label>
                            <input type="number" id="initial_debt" value="200" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="default_annual_debt_repayment">Annual Debt Repayment (Default):</label>
                            <input type="number" id="default_annual_debt_repayment" value="50" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="interest_rate">Interest Rate (%):</label>
                            <input type="number" id="interest_rate" value="5" step="0.1" required>
                        </div>
                    </div> 
                    
                    <div class="right-pane">
                        <h2>Granular Drivers (Annual)</h2>
                        <p style="font-size:0.9em; color:#666;">Note: Even if Monthly View is selected, inputs here define the trends for the full years. Monthly figures will be derived from these annual assumptions.</p>
                        
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="revenue-growth-container">Revenue Growth (%) <span class="toggle-icon">▼</span></h4>
                            <div id="revenue-growth-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="cogs-pct-container">COGS % <span class="toggle-icon">▼</span></h4>
                            <div id="cogs-pct-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="fixed-opex-container">Fixed Opex <span class="toggle-icon">▼</span></h4>
                            <div id="fixed-opex-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="capex-container">CapEx <span class="toggle-icon">▼</span></h4>
                            <div id="capex-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="dso-days-container">DSO (Days) <span class="toggle-icon">▼</span></h4>
                            <div id="dso-days-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="dio-days-container">DIO (Days) <span class="toggle-icon">▼</span></h4>
                            <div id="dio-days-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="dpo-days-container">DPO (Days) <span class="toggle-icon">▼</span></h4>
                            <div id="dpo-days-container" class="collapsible-content"></div>
                        </div>
                        <div class="granular-section">
                            <h4 class="collapsible-header collapsed" data-target="debt-repayment-container">Debt Repayment <span class="toggle-icon">▼</span></h4>
                            <div id="debt-repayment-container" class="collapsible-content"></div>
                        </div>
                    </div> 
                </div> 
                
                <button type="submit" id="calculateBtn">Calculate Forecast</button>
                <p id="error-message" class="error-message"></p>
            </form>
        </div>

        <div id="pl-page" class="page-section" style="display:none;">
            <h2>Income Statement</h2>
            <div class="table-responsive">
                <table id="incomeStatementTable"><thead></thead><tbody></tbody></table>
            </div>
            <div style="width: 100%; max-width: 800px; margin: 30px auto;">
                <canvas id="revenueKpiChart"></canvas>
            </div>
        </div>
        
        <div id="bs-page" class="page-section" style="display:none;">
            <h2>Balance Sheet</h2>
            <div class="table-responsive">
                <table id="balanceSheetTable"><thead></thead><tbody></tbody></table>
            </div>
            <div style="width: 100%; max-width: 800px; margin: 30px auto;">
                <canvas id="cashDebtChart"></canvas>
            </div>
        </div>

        <div id="cf-page" class="page-section" style="display:none;">
            <h2>Cash Flow Statement</h2>
            <div class="table-responsive">
                <table id="cashFlowTable"><thead></thead><tbody></tbody></table>
            </div>
            <button id="exportBtn">Export Full Model to Excel</button>
        </div>

    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="script.js"></script>
</body>
</html>
