<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Forecast App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Integrated Financial Forecast</h1>
        <p>Step 1: Set Horizon & Resolution. Step 2: Fill Assumptions.</p>

        <h2>1. Forecast Settings</h2>
        <div class="settings-row">
            <div class="duration-group">
                <label>Total Horizon:</label>
                <div id="year-selector" class="duration-buttons">
                    <button type="button" class="year-select-btn selected-year-btn" data-value="3">3 Years</button>
                    <button type="button" class="year-select-btn" data-value="5">5 Years</button>
                    <button type="button" class="year-select-btn" data-value="10">10 Years</button>
                </div>
            </div>

            <div class="mode-group">
                <label>Viewing Resolution:</label>
                <div class="toggle-buttons">
                    <button type="button" class="mode-btn active" data-mode="annual">Annual View</button>
                    <button type="button" class="mode-btn" data-mode="monthly">Monthly Split</button>
                </div>
            </div>
        </div>

        <form id="forecastForm">
            <input type="hidden" id="total_years_val" name="total_years_val" value="3">
            <input type="hidden" id="period_mode" name="period_mode" value="annual">

            <h2>2. Global Assumptions</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label>Initial Annual Revenue:</label>
                    <input type="number" id="initial_revenue" value="1000000" step="any">
                </div>
                <div class="input-group">
                    <label>Tax Rate (%):</label>
                    <input type="number" id="tax_rate" value="25" step="any">
                </div>
                <div class="input-group">
                    <label>Initial Net PP&E:</label>
                    <input type="number" id="initial_ppe" value="500000" step="any">
                </div>
                <div class="input-group">
                    <label>Depreciation Rate (% of PPE):</label>
                    <input type="number" id="depreciation_rate" value="10" step="any">
                </div>
                <div class="input-group">
                    <label>Initial Debt:</label>
                    <input type="number" id="initial_debt" value="200000" step="any">
                </div>
                <div class="input-group">
                    <label>Initial Cash:</label>
                    <input type="number" id="initial_cash" value="100000" step="any">
                </div>
                <div class="input-group">
                    <label>Interest Rate on Debt (%):</label>
                    <input type="number" id="interest_rate" value="5" step="any">
                </div>
            </div>

            <h2>3. Annualized Drivers</h2>
            <p><small>Values entered below are applied to each year in the horizon.</small></p>

            <div class="assumption-block">
                <div class="granular-header">
                    <span>Revenue Growth (%)</span>
                    <input type="number" id="default_revenue_growth" value="5" class="default-input">
                </div>
                <div id="revenue-growth-container" class="granular-inputs"></div>
            </div>

            <div class="assumption-block">
                <div class="granular-header">
                    <span>COGS (% of Rev)</span>
                    <input type="number" id="default_cogs_pct" value="40" class="default-input">
                </div>
                <div id="cogs-pct-container" class="granular-inputs"></div>
            </div>

            <div class="assumption-block">
                <div class="granular-header">
                    <span>Fixed OpEx ($)</span>
                    <input type="number" id="default_fixed_opex" value="200000" class="default-input">
                </div>
                <div id="fixed-opex-container" class="granular-inputs"></div>
            </div>

            <div class="assumption-block">
                <div class="granular-header">
                    <span>CapEx ($)</span>
                    <input type="number" id="default_capex" value="50000" class="default-input">
                </div>
                <div id="capex-container" class="granular-inputs"></div>
            </div>

            <div class="assumption-block">
                <div class="granular-header">
                    <span>DSO / DIO / DPO (Days)</span>
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="default_dso_days" value="45" title="DSO">
                        <input type="number" id="default_dio_days" value="60" title="DIO">
                        <input type="number" id="default_dpo_days" value="30" title="DPO">
                    </div>
                </div>
                <div id="working-capital-container" class="granular-inputs-grid">
                    <div id="dso-days-container"></div>
                    <div id="dio-days-container"></div>
                    <div id="dpo-days-container"></div>
                </div>
            </div>

            <div class="assumption-block">
                <div class="granular-header">
                    <span>Annual Debt Repayment ($)</span>
                    <input type="number" id="default_annual_debt_repayment" value="20000" class="default-input">
                </div>
                <div id="debt-repayment-container" class="granular-inputs"></div>
            </div>

            <button type="submit" class="generate-btn">Generate Forecast</button>
        </form>

        <div id="error-message" style="color: red; margin-top: 20px;"></div>

        <div id="results-container" style="display: none; margin-top: 30px;">
            <div class="tabs-header">
                <button class="tab-link active" onclick="openTab(event, 'tab-income')">Income Statement</button>
                <button class="tab-link" onclick="openTab(event, 'tab-balance')">Balance Sheet</button>
                <button class="tab-link" onclick="openTab(event, 'tab-cashflow')">Cash Flow</button>
                <button class="tab-link" onclick="openTab(event, 'tab-charts')">Charts</button>
            </div>

            <div id="tab-income" class="tab-content" style="display: block;">
                <h2>Forecasted Income Statement</h2>
                <div class="table-responsive">
                    <table id="incomeStatementTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-balance" class="tab-content">
                <h2>Forecasted Balance Sheet</h2>
                <div class="table-responsive">
                    <table id="balanceSheetTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-cashflow" class="tab-content">
                <h2>Forecasted Cash Flow Statement</h2>
                <div class="table-responsive">
                    <table id="cashFlowTable"><thead></thead><tbody></tbody></table>
                </div>
            </div>

            <div id="tab-charts" class="tab-content">
                <h2>Visual Trends</h2>
                <div style="width: 100%; display: flex; flex-wrap: wrap; gap: 20px;">
                    <div style="flex: 1; min-width: 400px;"><canvas id="revenueKpiChart"></canvas></div>
                    <div style="flex: 1; min-width: 400px;"><canvas id="cashDebtChart"></canvas></div>
                </div>
            </div>

            <button id="exportBtn" class="generate-btn" style="background-color: #28a745; margin-top: 20px;">Export to Excel</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
